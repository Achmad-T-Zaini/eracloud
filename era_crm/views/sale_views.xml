<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="sale_order_form_era" model="ir.ui.view">
        <field name="name">sale.order.form.era</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form"/>
        <field name="arch" type="xml">

            <xpath expr="//group[@name='sale_shipping']" position="inside">
                <field name="manufacture_id" />
                <field name="amount_total" />
            </xpath>

            <xpath expr="//field[@name='order_line']/tree" position="replace">
                            <tree
                                string="Sales Order Lines"
                                editable="bottom"
                            >
                                <control>
                                    <create name="add_product_control" string="Add a product"/>
                                    <create name="add_section_control" string="Add a section" context="{'default_display_type': 'line_section'}"/>
                                    <create name="add_note_control" string="Add a note" context="{'default_display_type': 'line_note'}"/>
                                </control>

                                <field name="sequence" widget="handle" attrs="{'invisible': [('display_type', '=', 'line_subtotal')],}"/>
                                <!-- We do not display the type because we don't want the user to be bothered with that information if he has no section or note. -->
                                <field name="display_type" invisible="1"/>
                                <field name="order_sequence" invisible="1"/>
                                <field name="product_uom_category_id" invisible="1"/>
                                <field name="product_type" invisible="1"/>
                                <field name="product_updatable" invisible="1"/>
                                <field name="order_type" invisible="1"/>
                                <field
                                    name="product_id"
                                    attrs="{
                                        'readonly': ['|',('product_updatable', '=', False),('display_type', '=', 'line_subtotal')],
                                        'required': [('display_type', '=', False)],
                                    }"
                                    force_save="1"
                                    context="{
                                        'partner_id': parent.partner_id,
                                        'quantity': product_uom_qty,
                                        'pricelist': parent.pricelist_id,
                                        'uom':product_uom,
                                        'company_id': parent.company_id,
                                        'default_lst_price': price_unit,
                                        'default_description_sale': name
                                    }"
                                    options="{
                                        'no_open': True,
                                    }"
                                    domain="[('sale_ok', '=', True), '|', ('company_id', '=', False), ('company_id', '=', parent.company_id)]"
                                    widget="sol_product_many2one"
                                />
                                <field name="product_template_id"
                                    string="Product"
                                    invisible="1"
                                    attrs="{
                                        'readonly': [('product_updatable', '=', False)],
                                        'required': [('display_type', '=', False)],
                                    }"
                                    context="{
                                        'partner_id': parent.partner_id,
                                        'quantity': product_uom_qty,
                                        'pricelist': parent.pricelist_id,
                                        'uom':product_uom,
                                        'company_id': parent.company_id,
                                        'default_list_price': price_unit,
                                        'default_description_sale': name
                                    }"
                                    options="{
                                        'no_open': True,
                                    }"
                                    domain="[('sale_ok', '=', True), '|', ('company_id', '=', False), ('company_id', '=', parent.company_id)]"
                                    widget="sol_product_many2one"/>
                                <field name="name" widget="section_and_note_text" optional="show" attrs="{'readonly': [('display_type', '=', 'line_subtotal')],}"/>
                                <field name="analytic_distribution" widget="analytic_distribution"
                                           optional="hide"
                                           groups="analytic.group_analytic_accounting"
                                           options="{'product_field': 'product_id', 'business_domain': 'sale_order'}"/>
                                <field
                                    name="product_uom_qty" attrs="{'readonly': [('display_type', '=', 'line_subtotal')],}"
                                    decoration-info="(not display_type and invoice_status == 'to invoice')" decoration-bf="(not display_type and invoice_status == 'to invoice')"
                                    context="{
                                        'partner_id': parent.partner_id,
                                        'quantity': product_uom_qty,
                                        'pricelist': parent.pricelist_id,
                                        'uom': product_uom,
                                        'company_id': parent.company_id
                                    }"
                                />
                                <field
                                    name="qty_delivered"
                                    decoration-info="(not display_type and invoice_status == 'to invoice')" decoration-bf="(not display_type and invoice_status == 'to invoice')"
                                    string="Delivered"
                                    attrs="{
                                        'column_invisible': [('parent.state', 'not in', ['sale', 'done'])],
                                        'readonly': [('qty_delivered_method', '!=', 'manual')]
                                    }"
                                    optional="show"
                                />
                                <field name="qty_delivered_method" invisible="1"/>
                                <field
                                    name="qty_invoiced"
                                    decoration-info="(not display_type and invoice_status == 'to invoice')" decoration-bf="(not display_type and invoice_status == 'to invoice')"
                                    string="Invoiced"
                                    attrs="{'column_invisible': [('parent.state', 'not in', ['sale', 'done'])]}"
                                    optional="show"
                                />
                                <field name="qty_to_invoice" invisible="1"/>
                                <field name="product_uom_readonly" invisible="1"/>
                                <field name="product_uom" invisible="1" groups="!uom.group_uom"/>
                                <field
                                    name="product_uom"
                                    force_save="1"
                                    string="UoM"
                                    attrs="{
                                        'readonly': ['|',('product_uom_readonly', '=', True),('display_type', '=', 'line_subtotal')],
                                        'required': [('display_type', '=', False)],
                                    }"
                                    context="{'company_id': parent.company_id}"
                                    groups="uom.group_uom"
                                    options='{"no_open": True}'
                                    optional="show"
                                />
                                <field
                                    name="customer_lead"
                                    optional="hide"
                                    attrs="{'readonly': [('parent.state', 'not in', ['draft', 'sent', 'sale'])]}"
                                />
                                <field name="product_packaging_qty" attrs="{'invisible': ['|', ('product_id', '=', False), ('product_packaging_id', '=', False)]}" groups="product.group_stock_packaging" optional="show"/>
                                <field name="product_packaging_id" attrs="{'invisible': [('product_id', '=', False)]}" context="{'default_product_id': product_id, 'tree_view_ref':'product.product_packaging_tree_view', 'form_view_ref':'product.product_packaging_form_view'}" groups="product.group_stock_packaging" optional="show"/>
                                <field
                                    name="price_unit"
                                    attrs="{'readonly': ['|',('qty_invoiced', '&gt;', 0),('display_type', '=', 'line_subtotal')]}" force_save="1"
                                />
                                <field
                                    name="tax_id"
                                    widget="many2many_tags"
                                    options="{'no_create': True}"
                                    domain="[('type_tax_use','=','sale'),('company_id','=',parent.company_id), ('country_id', '=', parent.tax_country_id)]"
                                    context="{'active_test': True}"
                                    attrs="{'readonly': ['|',('qty_invoiced', '&gt;', 0),('display_type', '=', 'line_subtotal')]}"
                                    optional="show"
                                />
                                <field name="discount" string="Disc.%" groups="product.group_discount_per_so_line" optional="show" widget="sol_discount"
                                    attrs="{'readonly': [('display_type', '=', 'line_subtotal')],}"/>
                                <field name="is_downpayment" invisible="1"/>
                                <field name="price_subtotal" widget="monetary" groups="account.group_show_line_subtotals_tax_excluded" attrs="{'invisible': [('is_downpayment', '=', True)]}"/>
                                <field name="price_total" widget="monetary" groups="account.group_show_line_subtotals_tax_included" attrs="{'invisible': [('is_downpayment', '=', True)]}"/>
                                <field name="state" invisible="1"/>
                                <field name="invoice_status" invisible="1"/>
                                <field name="currency_id" invisible="1"/>
                                <field name="price_tax" invisible="1"/>
                                <field name="company_id" invisible="1"/>
                                <field name="recurrence_id" invisible="1"/>
                            </tree>
            </xpath>

        </field>
    </record>

</odoo>
